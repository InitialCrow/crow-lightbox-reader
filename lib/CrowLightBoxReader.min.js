"use strict"
function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t)
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0})
var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i]
o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react)
require("./CrowLightBoxReader.css")
var CrowLightBoxReader=function(e){function t(e){_classCallCheck(this,t)
var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))
return i.poolItems=e.items||[],i.isRead=e.isRead||0,i.closeCallBack=e.closeCallBack||!1,i.settings=e.settings||{},i.showPool=i.settings.showPool||!0,i.showBtn=i.settings.showBtn||!0,i.showCloseBtn=i.settings.showCloseBtn||!0,i.showDesc=i.settings.showDesc||!0,i.showPagination=i.settings.showPagination||!0,i.nodeToHide=i.settings.nodeToHide||!1,i.showLightBox=i.settings.showLightBox||!1,i.debug=i.settings.debug||!1,i.nodes={main:null,thumb:[],desc:null,video:null,audio:null},i.poolHideNode=[],i.state={changeItem:!1},i}return _inherits(t,e),_createClass(t,[{key:"console",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:""
!1!==this.debug&&console.log(e)})},{key:"componentDidMount",value:function(){!1!==this.showLightBox&&(document.body.classList.add("crow-lightbox-reader-bg"),this.nodes.desc.style.maxWidth=this.poolItems[this.isRead].width+"px",this.nodes.thumb[this.isRead].classList.add("current")),!1!==this.nodeToHide&&this.deleteBody()}},{key:"deleteBody",value:function(){if(!1!==this.nodeToHide){var e=document.getElementById(this.nodeToHide)
for(e.classList.add("crow-hide");e.firstChild;)this.poolHideNode.push(e.firstChild),e.removeChild(e.firstChild)
e.prepend(this.nodes.main),e.classList.remove("crow-hide"),null!==this.nodes.video&&this.nodes.video.play(),null!==this.nodes.audio&&this.nodes.audio.play()}}},{key:"restoreBody",value:function(){if(!1!==this.nodeToHide&&this.poolHideNode.length>0){var e=document.getElementById(this.nodeToHide)
for(e.classList.add("crow-hide");e.firstChild;)e.removeChild(e.firstChild)
this.poolHideNode.map(function(t){e.appendChild(t)}),e.classList.remove("crow-hide")}}},{key:"closeLightBox",value:function(){!1!==this.closeCallBack&&!1!==this.showLightBox&&this.closeCallBack(),!1!==this.showLightBox&&(document.body.classList.remove("crow-lightbox-reader-bg"),this.showLightBox=!1,this.restoreBody(),this.setState({renderItem:!1}))}},{key:"changeItem",value:function(e){this.nodes.thumb[this.isRead].classList.remove("current"),this.isRead=e,this.nodes.thumb[this.isRead].classList.add("current"),this.setState({renderItem:!0})}},{key:"changeNextItem",value:function(){this.isRead<this.poolItems.length-1&&(this.nodes.thumb[this.isRead].classList.remove("current"),this.isRead++,this.nodes.thumb[this.isRead].classList.add("current"),this.setState({renderItem:!0}))}},{key:"changePrevItem",value:function(){this.isRead>0&&(this.nodes.thumb[this.isRead].classList.remove("current"),this.isRead--,this.nodes.thumb[this.isRead].classList.add("current"),this.setState({renderItem:!0}))}},{key:"renderPagination",value:function(){if(!1!==this.showPagination){var e=this.isRead+1,t=this.poolItems.length
return _react2.default.createElement("p",{className:"crow-lightbox-reader-pagination"},e," / ",t)}}},{key:"renderDesc",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:""
if(!1!==this.showDesc)return null!==this.nodes.desc&&(this.nodes.desc.style.maxWidth=t.width+"px"),_react2.default.createElement("p",{ref:function(t){e.nodes.desc=t},className:"crow-lightbox-reader-desc"},t.desc)}},{key:"renderCloseBtn",value:function(){var e=this
if(!1!==this.showCloseBtn)return _react2.default.createElement("span",{className:"lightbox-close-btn",onClick:function(){e.closeLightBox()}},"❌")}},{key:"renderBtn",value:function(){var e=this
if(!1!==this.showBtn)return _react2.default.createElement("div",null,_react2.default.createElement("div",{className:"crow-lightbox-reader-prev",onClick:function(){e.changePrevItem()}},_react2.default.createElement("p",{className:"lightbox-btn"},"❰")),_react2.default.createElement("div",{className:"crow-lightbox-reader-next",onClick:function(){e.changeNextItem()}},_react2.default.createElement("p",{className:"lightbox-btn"},"❯")))}},{key:"renderVideoItemThumb",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments[1]
return"video"===t.type?_react2.default.createElement("li",{onClick:function(){e.changeItem(i)},ref:function(t){e.nodes.thumb.push(t)},key:i.toString(),className:"pool-item"},_react2.default.createElement("video",{src:t.src,width:t.thumbWidth,height:t.thumbHeight,onPlay:function(e){e.preventDefault()}})):""==t.type||void 0==t.type?void this.console("Bug on CrowLightBoxReader => renderVideoItemThumb func || you need to write type ('video', 'image', 'song') property in items pool "):void 0}},{key:"renderImageItemThumb",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments[1]
return"image"===t.type?_react2.default.createElement("li",{onClick:function(){e.changeItem(i)},ref:function(t){e.nodes.thumb.push(t)},key:i.toString(),className:"pool-item"},_react2.default.createElement("img",{src:t.src,width:t.thumbWidth,height:t.thumbHeight,alt:t.alt})):""==t.type||void 0==t.type?void this.console("Bug on CrowLightBoxReader => renderImageItemThumb func || you need to write type ('video', 'image', 'song') property in items pool "):void 0}},{key:"renderAudioItemThumb",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments[1]
return"audio"===t.type?_react2.default.createElement("li",{onClick:function(){e.changeItem(i)},ref:function(t){e.nodes.thumb.push(t)},key:i.toString(),className:"pool-item"},_react2.default.createElement("img",{src:t.thumbSrc,width:t.thumbWidth,height:t.thumbHeight,alt:"thumbnail of audio content"})):""==t.type||void 0==t.type?void this.console("Bug on CrowLightBoxReader => renderAudioItemThumb func || you need to write type ('video', 'image', 'song') property in items pool "):void 0}},{key:"renderItem",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:""
return"video"===t.type?_react2.default.createElement("div",{className:"render-content"},this.renderDesc(t),this.renderBtn(),_react2.default.createElement("video",{ref:function(t){e.nodes.video=t},width:t.width,height:t.height,src:t.src,autoPlay:!0,controls:!0}),this.renderPagination()):"audio"===t.type?_react2.default.createElement("div",{className:"render-content"},this.renderDesc(t),this.renderBtn(),_react2.default.createElement("img",{width:t.width,height:t.height,src:t.thumbSrc,alt:"image of song reader"}),_react2.default.createElement("audio",{ref:function(t){e.nodes.audio=t},className:"audio",src:t.src,autoPlay:!0,controls:!0}),this.renderPagination()):"image"===t.type?_react2.default.createElement("div",{className:"render-content"},this.renderDesc(t),this.renderBtn(),_react2.default.createElement("img",{width:t.width,height:t.height,className:"render-content",src:t.src,alt:t.alt}),this.renderPagination()):""==t||void 0==t.type?void this.console("Bug on CrowLightBoxReader => renderItemRender func || you need to write type ('video', 'image', 'song') property in items pool "):void 0}},{key:"renderItemRenderer",value:function(){return _react2.default.createElement("div",{key:"r0",className:"crow-lightbox-reader-render"},this.renderItem(this.poolItems[this.isRead]))}},{key:"renderPoolItemsThumb",value:function(){var e=this
if(""!=this.poolItems){var t=[]
return this.poolItems.map(function(i,o){void 0!==e.renderVideoItemThumb(i,o)&&t.push(e.renderVideoItemThumb(i,o)),void 0!==e.renderImageItemThumb(i,o)&&t.push(e.renderImageItemThumb(i,o)),void 0!==e.renderAudioItemThumb(i,o)&&t.push(e.renderAudioItemThumb(i,o))}),t}return void this.console("Bug on CrowLightBoxReader => renderPoolItemsThumb func || you need to pass not empty items into items props on lightbox")}},{key:"renderPoolListThumb",value:function(){if(!1!==this.showPool)return _react2.default.createElement("ul",{key:"r1",className:"crow-lightbox-reader-pool-list"},this.renderPoolItemsThumb())}},{key:"showRenderer",value:function(){var e=this
if(!1!==this.showLightBox){var t=[]
return t.push(this.renderItemRenderer()),t.push(this.renderPoolListThumb()),_react2.default.createElement("div",{ref:function(t){e.nodes.main=t},className:"crow-lightbox-reader"},this.renderCloseBtn(),t)}return null}},{key:"render",value:function(){return _react2.default.createElement("div",null,this.showRenderer())}}]),t}(_react.Component)
exports.default=CrowLightBoxReader
